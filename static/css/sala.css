/* --- static/css/sala.css --- */

/* =========================================
   1. ESTÉTICA (Para que se vea bonito)
   ========================================= */
body {
    /* Si 'styles.css' ya define esto, no importa, lo reforzamos */
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: #f4f4f4;
    margin: 0;
    padding: 20px;
    display: flex;
    flex-direction: column;
    align-items: center;
    min-height: 100vh;
}

h1 { margin-bottom: 10px; color: #333; }
small { color: #666; font-weight: normal; }

/* =========================================
   2. EL ESCENARIO (El contenedor padre)
   ========================================= */
#avi-stage {
    position: relative !important; /* Forzamos posición relativa */
    width: 100%;
    max-width: 1280px;
    height: 720px;
    margin-top: 10px;
    border: 2px solid #444;
    background: #000;
    overflow: hidden;

    /* TRUCO NUEVO: Aislamiento */
    /* Esto protege tus capas (z-index) de los estilos externos */
    isolation: isolate;

    box-shadow: 0 10px 25px rgba(0,0,0,0.5);
    border-radius: 8px; /* Un toque estético extra */
}

/* =========================================
   3. SISTEMA DE CAPAS (Funcionalidad)
   ========================================= */

/* NIVEL 0: El Fondo (Sótano) */
#avi-background {
    position: absolute;
    inset: 0;
    width: 100%; height: 100%;
    z-index: 1 !important; /* Nivel 1 */
    background: #000;
    pointer-events: none;
}
#avi-background iframe {
    position: absolute;
    width: 100%; height: 100%;
    border: 0;
    z-index: 1 !important;
}

/* NIVEL 2: Pizarra Blanca */
#avi-whiteboard {
    position: absolute;
    inset: 0;
    z-index: 50 !important;
    pointer-events: none;
}
#avi-whiteboard.drawing-mode {
    pointer-events: auto;
    cursor: crosshair;
}

/* NIVEL 3: Varita Mágica (IA) */
/* Aquí aplicamos lo que te funcionó en styles.css */
#magic-canvas {
    position: absolute;
    top: 0; left: 0;
    width: 100%; height: 100%;

    /* Z-Index alto para ganar al video */
    z-index: 100 !important;

    pointer-events: none;

    /* Forzar GPU (Hardware Acceleration) */
    transform: translate3d(0,0,0);
}

/* NIVEL 4: Participantes (Cajas) */
#avi-participants {
    position: absolute;
    inset: 0;
    z-index: 200 !important;
    pointer-events: none;
}

/* Estilo de las Cajas Individuales (Bonitas) */
.participant {
    position: absolute;
    z-index: 201 !important;
    pointer-events: auto;

    /* Diseño de la caja */
    width: 260px; height: 150px;
    background: rgba(20, 20, 20, 0.95); /* Un poco más oscuro */
    border: 2px solid #555;
    border-radius: 8px;
    overflow: hidden;
    cursor: grab;

    /* Centrado del contenido */
    display: flex; align-items: center; justify-content: center;
    box-shadow: 0 8px 16px rgba(0,0,0,0.4);
    transition: border-color 0.2s;
}
.participant:hover { border-color: #777; }
.participant iframe { width: 100%; height: 100%; border: none; pointer-events: none; }

/* Etiqueta de nombre en la caja */
.label-participant {
    position: absolute; bottom: 0; width: 100%;
    background: rgba(0,0,0,0.7); color: white;
    font-size: 12px; text-align: center; padding: 4px 0;
}

/* =========================================
   4. LA INTERFAZ (Botones y Menús)
   ========================================= */
#avi-tools {
    position: relative;
    z-index: 5000 !important;
    width: 100%;
    /* Max-width del contenedor para que no se estire infinito en PC */
    max-width: 100vw;

    background: #fff;
    padding: 10px 0;
    box-shadow: 0 4px 15px rgba(0,0,0,0.2);
    margin-bottom: 20px;

    display: flex;
    align-items: center;

    /* Por defecto centrado en PC */
    justify-content: center;
    gap: 10px;
    box-sizing: border-box;
}

/* AJUSTE PARA MÓVILES (Celulares) */
@media (max-width: 768px) {
    #avi-tools {
        /* En móvil alineamos al inicio para que el scroll funcione bien */
        justify-content: flex-start;

        /* Permitir scroll horizontal */
        overflow-x: auto;

        /* Padding lateral para que los botones no toquen el borde */
        padding: 10px 15px;

        /* Suavidad en iPhone */
        -webkit-overflow-scrolling: touch;
    }

    /* Ocultar la barra de scroll fea pero mantener la función */
    #avi-tools::-webkit-scrollbar { display: none; }

    /* Que los botones no se aplasten */
    #avi-tools button {
        flex-shrink: 0;
        white-space: nowrap;
    }
}

/* Botones */
button {
    padding: 10px 18px;
    cursor: pointer;
    border-radius: 6px;
    border: 1px solid #ddd;
    background: #f8f9fa;
    color: #333;
    font-weight: 600;
    transition: all 0.2s;
}
button:hover { background: #e2e6ea; transform: translateY(-1px); }
button.active { background: #e8f0fe; color: #1a73e8; border-color: #1a73e8; }

/* Botones especiales */
.btn-green { background: #2ecc71; color: white; border: none; }
.btn-green:hover { background: #27ae60; }

.btn-purple { background: #9b59b6; color: white; border: none; }
.btn-purple:hover { background: #8e44ad; }

/* Estado Varita Activa */
.wand-active {
    background-color: #8e44ad !important;
    color: white !important;
    border-color: #8e44ad !important;
    box-shadow: 0 0 15px rgba(142, 68, 173, 0.6);
    animation: pulse 1.5s infinite;
}

/* Reacciones (Menú Flotante) */
.reaction-wrapper { position: relative; z-index: 5001; }
#reaction-panel {
    position: absolute; left: 0; top: 110%; /* Debajo del botón */
    z-index: 5002;
    background: white; padding: 10px;
    border-radius: 8px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    display: grid; grid-template-columns: repeat(3, 1fr); gap: 5px;
    width: 120px;
}
#reaction-panel.hidden { display: none !important; }
#reaction-panel span { font-size: 1.5rem; cursor: pointer; text-align: center; }
#reaction-panel span:hover { transform: scale(1.2); }

@keyframes pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.05); }
    100% { transform: scale(1); }
}